# vim:filetype=zsh

local BUJO="$NOTESDIR/.bujo"

__sed() {
  command sed "s/\(^.*\) $1\([0-9-]*\)/\2: \1/g"
}

__grep() {
  command grep -ne "$1[0-9-]*" "$BUJO"
}

__cat() {
  command grep -nv "\.[0-9-]*" "$BUJO"
}

[[ -r "$BUJO" ]] || touch "$BUJO"

if [[ "$1" ]]; then
  case "$1" in
    l | ls )
      case "$2" in
        = | scheduled )
          __grep '=' | __sed '=' | sort -g
          ;;
        ! | due )
          __grep '!' | __sed '!' | sort -g
          ;;
        . | complete )
          __grep '\.' | __sed '\.' | sort -g
          ;;
        [@:]* )
          command grep -ne "$2" "$BUJO"
          ;;
        all )
          cat "$BUJO"
          ;;
        * )
          __cat
          ;;
      esac
      ;;
    e | edit )
      (cd $NOTESDIR && $EDITOR $BUJO +"$2")
      ;;
    a | add )
      echo "${@:2}" >> "$BUJO"
      ;;
  esac
else
  bujo ls
fi
