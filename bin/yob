#!/usr/bin/env bash

LIGHT_THEME="Modus Operandi"
DARK_THEME="Modus Vivendi"
LOCATION="$HOME/.local/share/yob"
VIM_BG_FILE="$LOCATION/background"
[[ ! -d "$LOCATION" ]] && mkdir -p "$LOCATION"
[[ ! -e "$VIM_BG_FILE" ]] && touch "$VIM_BG_FILE"

__update() {

  TMPFILE="$(mktemp)"
  if [[ "$1" == "light" ]]; then
    kitty +kitten themes --config-file-name="$TMPFILE" "$LIGHT_THEME"
    echo "base16-classic-light" >"$VIM_BG_FILE" # lowercase all
    echo "light" >>"$VIM_BG_FILE"
  else
    kitty +kitten themes --config-file-name="$TMPFILE" "$DARK_THEME"
    echo "base16-classic-dark" >"$VIM_BG_FILE" # lowercase all
    echo "dark" >>"$VIM_BG_FILE"
  fi

  rm -f "$TMPFILE" # cleanup
}

__toggle() {
  # Toggle between light and dark themes. Some preliminary error

  local CURRENT_BG
  CURRENT_BG="$(head -n 1 "$VIM_BG_FILE")"
  if [[ "$CURRENT_BG" =~ "light" ]]; then
    __update "dark"
  else
    __update "light"
  fi
}

main() {
  if [[ "$#" -eq 0 ]]; then
    __toggle
  else
    __update "$1"
  fi
}

main "$@"
