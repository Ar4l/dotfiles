#!/usr/bin/env bash

__session_exists() {
  tmux list-sessions | sed -E 's/:.*$//' | grep -q "^$SESSION_NAME$"
}

__create_detached_session() {
  (TMUX='' tmux new-session -Ad -s "$SESSION_NAME")
}

t() {
  # Early return if provided with args.
  if [[ -n "$@" ]]; then
    tmux "$@"
    return
  fi

  # Attach to existing session, or create one, based on current directory.
  local SESSION_NAME=$(basename "${PWD//[.:]/_}")

  if [[ -z "$TMUX" ]]; then
    tmux new -A -s "$SESSION_NAME"
  else
    if ! __session_exists; then __create_detached_session; fi
    tmux switch-client -t "$SESSION_NAME"
  fi
}

t "$@"
