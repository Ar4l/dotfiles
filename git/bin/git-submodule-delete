#!/usr/bin/env bash

# source: https://www.vogella.com/tutorials/GitSubmodules/article.html
if [[ -z "$1" ]]; then
  echo "path to submodule required."
  exit 1
fi

if [[ ! -d "$1" ]]; then
  echo "path must be a directory."
  exit 1
fi

CWD=$(pwd)
SMD="$1"

function _echo_info() {
  # the following cannot be indented
cat <<END
current working directory: "$CWD"
git submodule to delete: "$SMD"
END
}

function _echo_warning() {
  # the following cannot be indented
cat <<END
WARNING! This command will cause permanent loss of data
and remove files from the git working tree and index.
END
}

function _confirm() {
  _echo_info
  _echo_warning
  echo -n "Are you sure you want to continue? [y/n]: "
}

function main() {
  _confirm

  read -n 1 ANS

  if [[ "$ANS" == "y" ]] || [[ "$ANS" == "Y" ]]; then
    git submodule deinit --force -- "$SMD"
    rm -rfv "$CWD/.git/modules/$SMD"
    git rm --force "$SMD"
  else
    echo; echo "command terminated by user."
    return 1
  fi
}

main
