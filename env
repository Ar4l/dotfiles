#!/usr/bin/env fish

function _echo-ok
    printf "\r\033[2K\033[0;32m[ OK ]\033[0m %s\n" "$argv"
end

function _echo-fail
    printf "\r\033[2K\033[0;31m[ FAIL ]\033[0m %s\n" "$argv"
end

# TODO: work in progress, needs work.
function _mklink -d "Creates a symbolic"
   set target $argv[1]
   set dest $argv[2]
   set flags "-s"

   command ln $flags target $dest
end

function _is_callable
    command -sq $argv ; or false
end

function _is_valid_topic -d "accepts a TOPIC and checks if a corresponding dir \
is present in the root dir of the project and if TOPIC/_init exists"

    function _valid_topic
        ls -ld */ | grep $argv > /dev/null
        and ls $argv | grep _init > /dev/null
    end

    _valid_topic $argv ; or false
end

function _enable_topic -d "adds topic to list of enabled topics"
    set topic $argv

    if not contains $topic $ENABLED_TOPICS
        set -U ENABLED_TOPICS $ENABLED_TOPICS $topic
        _echo-ok "$topic enabled!"
    else
        _echo-ok "$topic already enabled!"
        false
    end
end

function _disable_topic -d "removes topic from list of enabled topics"
    set topic $argv

    if contains $topic $ENABLED_TOPICS
        set index (contains -i $topic $ENABLED_TOPICS)
        set -e ENABLED_TOPICS[$index]
        echo "$topic disabled!"
    else
        echo "$topic already disabled!"
        false
    end
end
